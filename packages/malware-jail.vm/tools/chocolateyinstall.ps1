$ErrorActionPreference = 'Stop'
Import-Module vm.common -Force -DisableNameChecking

try {
    $toolName = 'malware-jail'
    $category = 'Javascript'

    $zipUrl = 'https://github.com/HynekPetrak/malware-jail/archive/ec370f1433652fdd346995f1d6f00b26368aa611.zip'
    $zipSha256 = '027b59bdb5c0b8b20ae348269b320b924be34c4cb4ae708704290e67c23e8d4d'
    # Install dependencies with npm when running shortcut as we ignore errors below
    $powershellCommand = "npm install; node jailme.js -h -b list"

    $toolDir = VM-Install-Raw-GitHub-Repo $toolName $category $zipUrl $zipSha256 -powershellCommand $powershellCommand

} catch {
    VM-Write-Log-Exception $_
}

# Prevent the following warning from failing the package: "npm WARN deprecated request@2.79.0"
$ErrorActionPreference = 'Continue'
# Get absolute path as npm is not in path until Powershell is restarted
$npmPath = Join-Path ${Env:ProgramFiles} "\nodejs\npm.cmd" -Resolve
# Install tool dependencies with npm
Set-Location $toolDir; & "$npmPath" install | Out-Null
